<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Company To-Do Hub</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 300; }
    .header p { opacity: 0.9; font-size: 1.1em; }
    .controls { padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
    .user-section { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; }
    .user-select {
      padding: 12px 20px; border: 2px solid #ddd; border-radius: 25px;
      background: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;
    }
    .user-select:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
    .add-task-form { display: flex; gap: 15px; flex-wrap: wrap; align-items: end; }
    .form-group { flex: 1; min-width: 200px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
    .form-group input, .form-group select {
      width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px;
      font-size: 16px; transition: border-color 0.3s ease;
    }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #3498db; }
    .btn {
      padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer;
      font-size: 16px; font-weight: 600; transition: all 0.3s ease;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
    .filters { padding: 20px 30px; background: #ffffff; border-bottom: 1px solid #e9ecef; display: flex; gap: 15px; flex-wrap: wrap; }
    .filter-btn {
      padding: 8px 16px; border: 2px solid #ddd; background: white;
      border-radius: 20px; cursor: pointer; transition: all 0.3s ease; font-size: 14px;
    }
    .filter-btn.active { background: #3498db; color: white; border-color: #3498db; }
    .tasks-container { padding: 30px; min-height: 400px; }
    .task-card {
      background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); border-left: 5px solid;
      transition: all 0.3s ease; position: relative;
    }
    .task-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); }
    .task-card.priority-high { border-left-color: #e74c3c; }
    .task-card.priority-medium { border-left-color: #f39c12; }
    .task-card.priority-low { border-left-color: #27ae60; }
    .task-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
    .task-title { font-size: 1.2em; font-weight: 600; color: #2c3e50; margin-bottom: 5px; }
    .task-meta { font-size: 0.9em; color: #7f8c8d; }
    .task-actions { display: flex; gap: 10px; }
    .task-btn { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease; }
    .btn-complete { background: #27ae60; color: white; }
    .btn-expire { background: #e74c3c; color: white; }
    .btn-renew { background: #f39c12; color: white; }
    .btn-delete { background: #95a5a6; color: white; }
    .task-status {
      position: absolute; top: 15px; right: 15px; padding: 4px 12px;
      border-radius: 12px; font-size: 12px; font-weight: 600; text-transform: uppercase;
    }
    .status-pending { background: #3498db; color: white; }
    .status-completed { background: #27ae60; color: white; }
    .status-expired { background: #e74c3c; color: white; }
    .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; }
    .empty-state h3 { font-size: 1.5em; margin-bottom: 10px; }
    .online-indicator {
      position: fixed; top: 20px; right: 20px; display: flex; align-items: center;
      gap: 8px; background: rgba(255, 255, 255, 0.9); padding: 8px 15px;
      border-radius: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #27ae60; animation: pulse 2s infinite; }
    @keyframes pulse { 0%{opacity:1;} 50%{opacity:0.5;} 100%{opacity:1;} }
    @media (max-width: 768px) {
      .container { margin: 10px; border-radius: 15px; }
      .header { padding: 20px; }
      .header h1 { font-size: 1.8em; }
      .controls { padding: 20px; }
      .add-task-form { flex-direction: column; }
      .form-group { min-width: auto; }
      .filters { padding: 15px 20px; }
      .tasks-container { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="online-indicator">
    <div class="status-dot"></div>
    <span>Live Sync</span>
  </div>

  <div class="container">
    <div class="header">
      <h1>Company To-Do Hub</h1>
      <p>Collaborative task management for your team</p>
    </div>

    <div class="controls">
      <div class="user-section">
        <select id="currentUser" class="user-select">
          <option value="">Select Your Role</option>
          <option value="Doctor">Doctor</option>
          <option value="Director">Director</option>
          <option value="Accountant">Accountant</option>
          <option value="Manager">Manager</option>
          <option value="Assistant">Assistant</option>
        </select>
      </div>

      <form class="add-task-form" id="addTaskForm">
        <div class="form-group">
          <label>Task Description</label>
          <input type="text" id="taskInput" placeholder="Enter task description..." required>
        </div>
        <div class="form-group">
          <label>Priority</label>
          <select id="prioritySelect">
            <option value="medium">Medium</option>
            <option value="high">High</option>
            <option value="low">Low</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Add Task</button>
      </form>
    </div>

    <div class="filters">
      <button class="filter-btn active" data-filter="all">All Tasks</button>
      <button class="filter-btn" data-filter="pending">Pending</button>
      <button class="filter-btn" data-filter="completed">Completed</button>
      <button class="filter-btn" data-filter="expired">Expired</button>
      <button class="filter-btn" data-filter="high">High Priority</button>
    </div>

    <div class="tasks-container" id="tasksContainer">
      <div class="empty-state">
        <h3>No tasks yet</h3>
        <p>Add your first task above to get started</p>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js"></script>

  <!-- Firebase SDK -->
<script type="module">
  // Import modular functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // Config
  const firebaseConfig = {
    apiKey: "AIzaSyAaciuGCoGyoRHwdPaqBEr47zZgJgzaxzM",
    authDomain: "kashi-to-do-app.firebaseapp.com",
    projectId: "kashi-to-do-app",
    storageBucket: "kashi-to-do-app.firebasestorage.app",
    messagingSenderId: "48006018766",
    appId: "1:48006018766:web:4daef4fa63bb950b3a029f"
  };

  // Init
  const appFirebase = initializeApp(firebaseConfig);
  const db = getFirestore(appFirebase);

  class TodoApp {
    constructor() {
      this.tasks = [];
      this.currentFilter = 'all';
      this.currentUser = '';
      this.init();
    }

    init() {
      this.bindEvents();
      this.listenForTasks();
    }

    bindEvents() {
      document.getElementById('addTaskForm').addEventListener('submit', (e) => {
        e.preventDefault();
        this.addTask();
      });

      document.getElementById('currentUser').addEventListener('change', (e) => {
        this.currentUser = e.target.value;
      });

      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelector('.filter-btn.active').classList.remove('active');
          e.target.classList.add('active');
          this.currentFilter = e.target.dataset.filter;
          this.renderTasks();
        });
      });
    }

    async addTask() {
      const taskInput = document.getElementById('taskInput');
      const prioritySelect = document.getElementById('prioritySelect');

      if (!this.currentUser) {
        alert('Please select your role first!');
        return;
      }
      if (!taskInput.value.trim()) {
        alert('Please enter a task description!');
        return;
      }

      const task = {
        id: Date.now(),
        text: taskInput.value.trim(),
        priority: prioritySelect.value,
        status: 'pending',
        createdBy: this.currentUser,
        createdAt: new Date().toLocaleString(),
        expiresAt: new Date(Date.now() + 7*24*60*60*1000).toLocaleDateString()
      };

      await setDoc(doc(db, "tasks", task.id.toString()), task);

      taskInput.value = '';
      prioritySelect.value = 'medium';
    }

    async updateTaskStatus(taskId, newStatus) {
      const taskRef = doc(db, "tasks", taskId.toString());
      const updates = { status: newStatus };
      if (newStatus === 'completed') updates.completedAt = new Date().toLocaleString();
      if (newStatus === 'expired') updates.expiredAt = new Date().toLocaleString();
      await updateDoc(taskRef, updates);
    }

    async renewTask(taskId) {
      const taskRef = doc(db, "tasks", taskId.toString());
      await updateDoc(taskRef, {
        status: 'pending',
        expiresAt: new Date(Date.now() + 7*24*60*60*1000).toLocaleDateString(),
        expiredAt: null,
        completedAt: null
      });
    }

    async deleteTask(taskId) {
      if (confirm('Are you sure you want to delete this task?')) {
        await deleteDoc(doc(db, "tasks", taskId.toString()));
      }
    }

    getFilteredTasks() {
      let filtered = this.tasks;
      switch (this.currentFilter) {
        case 'pending': filtered = this.tasks.filter(t => t.status === 'pending'); break;
        case 'completed': filtered = this.tasks.filter(t => t.status === 'completed'); break;
        case 'expired': filtered = this.tasks.filter(t => t.status === 'expired'); break;
        case 'high': filtered = this.tasks.filter(t => t.priority === 'high'); break;
      }
      return filtered;
    }

    renderTasks() {
      const container = document.getElementById('tasksContainer');
      const filteredTasks = this.getFilteredTasks();

      if (filteredTasks.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No tasks found</h3>
            <p>No tasks match the current filter</p>
          </div>`;
        return;
      }

      container.innerHTML = filteredTasks.map(task => `
        <div class="task-card priority-${task.priority}">
          <div class="task-status status-${task.status}">${task.status}</div>
          <div class="task-header">
            <div>
              <div class="task-title">${task.text}</div>
              <div class="task-meta">
                Created by ${task.createdBy} on ${task.createdAt}
                ${task.status === 'pending' ? `• Expires: ${task.expiresAt}` : ''}
                ${task.completedAt ? `• Completed: ${task.completedAt}` : ''}
                ${task.expiredAt ? `• Expired: ${task.expiredAt}` : ''}
              </div>
            </div>
          </div>
          <div class="task-actions">
            ${task.status === 'pending' ? `
              <button class="task-btn btn-complete" onclick="app.updateTaskStatus(${task.id}, 'completed')">Complete</button>
              <button class="task-btn btn-expire" onclick="app.updateTaskStatus(${task.id}, 'expired')">Mark Expired</button>
            ` : ''}
            ${task.status === 'expired' ? `
              <button class="task-btn btn-renew" onclick="app.renewTask(${task.id})">Renew</button>
            ` : ''}
            <button class="task-btn btn-delete" onclick="app.deleteTask(${task.id})">Delete</button>
          </div>
        </div>
      `).join('');
    }

    listenForTasks() {
      const q = query(collection(db, "tasks"), orderBy("id", "desc"));
      onSnapshot(q, snapshot => {
        this.tasks = snapshot.docs.map(doc => doc.data());
        this.renderTasks();
      });
    }
  }

  window.app = new TodoApp();
</script>

</body>
</html>
